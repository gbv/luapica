<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>pica: Module Index</title>
    <link rel="stylesheet" href="../luadoc.css" type="text/css" />
	<!--meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/-->
</head>

<body>
<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->

<div id="main">

<div id="navigation">


<h1>LuaDoc</h1>
<ul>
	
	<li><a href="../index.html">Index</a></li>
	
</ul>


<!-- Module list -->

<h1>Modules</h1>
<ul>

	<li><strong>pica</strong></li>
	
</ul>



<!-- File list -->

<h1>Files</h1>
<ul>

	<li>
		<a href="../files/lib/pica.html">lib/pica.lua</a>
	</li>

	<li>
		<a href="../files/lib/picaconv.html">lib/picaconv.lua</a>
	</li>

	<li>
		<a href="../files/scripts/brief.html">scripts/brief.lua</a>
	</li>

	<li>
		<a href="../files/scripts/ddc.html">scripts/ddc.lua</a>
	</li>

	<li>
		<a href="../files/scripts/fcvexample1.html">scripts/fcvexample1.lua</a>
	</li>

	<li>
		<a href="../files/scripts/pica2rdf.html">scripts/pica2rdf.lua</a>
	</li>

</ul>






</div><!-- id="navigation" -->

<div id="content">

<h1>Module <code>pica</code></h1>


<p>Handle PICA+ data in Lua. This module provides two classes (<a href="#PicaField">PicaField</a> and <a href="#PicaRecord">PicaRecord</a>) for PICA+ data. The programming interface of these classes is optimized for easy access and conversion of PICA+ records. Have a look at the file 'example.lua' for a synopsis. </p>


<p><b>Author:</b>
<ul class="authors_list">

	<li class="name">Jakob Voss <voss@gbv.de></li>

</ul>
</p>





<h2>Tables</h2>
<table class="table_list">

	<tr>
	<td class="name" nowrap><a href="#PicaField">PicaField</a></td>
	<td class="summary">Stores an ordered list of PICA+ subfields.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#PicaRecord">PicaRecord</a></td>
	<td class="summary">Stores a PICA+ record.</td>
	</tr>

</table>



    <h2>Functions</h2>
    <table class="function_list">
    
	<tr>
	<td class="name" nowrap><a href="#filtervalue">filtervalue</a>&nbsp;(value, ...)</td>
	<td class="summary">Simply returns a value, optionally filtered by one or more functions.</td>
	</tr>
    
	<tr>
	<td class="name" nowrap><a href="#formatfilter">formatfilter</a>&nbsp;(format)</td>
	<td class="summary">Returns a filter function based on a Lua string format.</td>
	</tr>
    
	<tr>
	<td class="name" nowrap><a href="#patternfilter">patternfilter</a>&nbsp;(pattern)</td>
	<td class="summary">Returns a filter function based on a Lua pattern.</td>
	</tr>
    
	<tr>
	<td class="name" nowrap><a href="#string.notempty">string.notempty</a>&nbsp;(self)</td>
	<td class="summary">Returns a string or nil if the string is empty </td>
	</tr>
    
	<tr>
	<td class="name" nowrap><a href="#table.append">table.append</a>&nbsp;(t, a)</td>
	<td class="summary">Insert all values with integer keys from one table to another.</td>
	</tr>
    
    </table>
  



<h2><a name="tables"></a>Tables</h2>
<dl class="table">

  
    <dt><a name="PicaField"></a><strong>PicaField</strong></dt>
<dd>Stores an ordered list of PICA+ subfields. This class overloads the following operators: <ul> <li><tt>#f</tt> returns the number of subfields.</li> <li><tt>f % l</tt> returns whether locator <tt>l</tt> applies to field <tt>f</tt> (see <a href="#PicaField:has">PicaField:has</a>). </ul>


<h3>Fields</h3>
<ul>
	
	<li>
	  n: (number) the <i>n</i>th subfield value or <tt>nil</tt>
        </li>
	
	<li>
	  c: (string) the <i>first</i> subfield value of a subfield with code <i>c</i> where <i>c</i> can be a letter (<tt>a-z</tt> or <tt>A-Z</tt>) or a digit (<tt>0-9</tt>). An empty string is returned if no such subfields exists (see <a href="#PicaField:has">PicaField:first</a>).
        </li>
	
	<li>
	  ok: (boolean) whether the field has a tag and is not empty
        </li>
	
	<li>
	  tag: (string) the tag without occurrence
        </li>
	
	<li>
	  full: (string) tag and occurrence combined
        </li>
	
	<li>
	  occ: (string) the occurrence as string
        </li>
	
	<li>
	  num: (number) the occurrence as number between 0 and 99
        </li>
	
	<li>
	  lev: (number) level 0, 1, or 2 (default is 0)
        </li>
	
</ul>


    
   
      <h3>Methods</h3>
      <ul>
        
        <li>
           <a href="#PicaField.new">PicaField.new</a>
           Creates a new PICA+ field.
        </li>
        
        <li>
           <a href="#PicaField:all">PicaField:all</a>
           Returns an ordered table of all matching values 
        </li>
        
        <li>
           <a href="#PicaField:append">PicaField:append</a>
           Appends one or more subfields.
        </li>
        
        <li>
           <a href="#PicaField:codes">PicaField:codes</a>
           Returns an ordered table of subfield codes.
        </li>
        
        <li>
           <a href="#PicaField:collect">PicaField:collect</a>
           Concatenate table of subfield values.
        </li>
        
        <li>
           <a href="#PicaField:copy">PicaField:copy</a>
           Copies a field.
        </li>
        
        <li>
           <a href="#PicaField:first">PicaField:first</a>
           Returns the first value of a given subfield or an empty string.
        </li>
        
        <li>
           <a href="#PicaField:has">PicaField:has</a>
           Checks whether a field contains a given subfield.
        </li>
        
        <li>
           <a href="#PicaField:join">PicaField:join</a>
           Collect and join subfield values.
        </li>
        
        <li>
           <a href="#PicaField:values">PicaField:values</a>
           Returns a list of subfield values.
        </li>
        
      </ul>
   


</dd>

  

  
    <dt><a name="PicaRecord"></a><strong>PicaRecord</strong></dt>
<dd>Stores a PICA+ record. Basically a PicaRecord is a list of PICA+ fields This class overloads the following operators: <ul> <li><tt>#r</tt> returns the number of fields.</li> <li><tt>r % l</tt> returns whether locator <tt>p</tt> matches <tt>r</tt> (see <a href="#PicaRecord:has">PicaRecord:has</a>). </ul>


<h3>Fields</h3>
<ul>
	
	<li>
	  n: (number) the <i>n</i>th field value
        </li>
	
	<li>
	  locator: (string) the first matching field or value (see <a href="#PicaRecord:first">PicaRecord:first</a>)
        </li>
	
</ul>


    
   
      <h3>Methods</h3>
      <ul>
        
        <li>
           <a href="#PicaRecord.new">PicaRecord.new</a>
           Creates a new PICA+ record.
        </li>
        
        <li>
           <a href="#PicaRecord.parse_field_locator">PicaRecord.parse_field_locator</a>
           Parses a field locator.
        </li>
        
        <li>
           <a href="#PicaRecord:all">PicaRecord:all</a>
           Returns all matching subfield values (as table) or all matching fields (as record).
        </li>
        
        <li>
           <a href="#PicaRecord:append">PicaRecord:append</a>
           Appends a field to the record.
        </li>
        
        <li>
           <a href="#PicaRecord:apply">PicaRecord:apply</a>
           Apply one or more function to each field of the record.
        </li>
        
        <li>
           <a href="#PicaRecord:first">PicaRecord:first</a>
           Returns the first matching field or subfield value 
        </li>
        
        <li>
           <a href="#PicaRecord:get">PicaRecord:get</a>
           Get matching values from the record.
        </li>
        
        <li>
           <a href="#PicaRecord:has">PicaRecord:has</a>
           Returns whether a given locator matches.
        </li>
        
        <li>
           <a href="#PicaRecord:map">PicaRecord:map</a>
           Transforms the record to a table using a mapping table.
        </li>
        
      </ul>
   


</dd>

  

</dl>






<h2><a name="functions"></a>Functions</h2>
<dl class="function">



<dt><a name="PicaField.new"></a><strong>PicaField.new</strong>&nbsp;(tag, occ, ...)</dt>
<dd>
Creates a new PICA+ field. The newly created field will have no subfields. The optional occurence indicator can only be set in addition to a valid tag. On failure this returns an empty field with its tag set to the empty string. On failure an empty PicaField instance is returned.


<h3>Parameters</h3>
<ul>
	
	<li>
	  tag: optional tag (e.g. <tt>021A</tt>) or tag and occurence (e.g. <tt>009P/09</tt>) or a full line of PICA+ format to parse.
	</li>
	
	<li>
	  occ: optional occurence indicator (<tt>01</tt> to <tt>99</tt>)
	</li>
	
	<li>
	  ...: 
	</li>
	
</ul>








</dd>




<dt><a name="PicaField:all"></a><strong>PicaField:all</strong>&nbsp;(code, ...)</dt>
<dd>
Returns an ordered table of all matching values


<h3>Parameters</h3>
<ul>
	
	<li>
	  code: 
	</li>
	
	<li>
	  ...: locator and/or filters
	</li>
	
</ul>








</dd>




<dt><a name="PicaField:append"></a><strong>PicaField:append</strong>&nbsp;(...)</dt>
<dd>
Appends one or more subfields. Subfields can either be specified in PICA+ format or as pairs of subfield code (one character of <tt>[a-zA-Z0-9]</tt>) and subfield value. Empty subfield values (the empty string <tt>""</tt>) are ignored.


<h3>Parameters</h3>
<ul>
	
	<li>
	  ...: 
	</li>
	
</ul>



<div>

<h3>Usage</h3>
<ul>
	
	<li><tt>f:append("x","foo","y","bar")</tt>
	
	<li><tt>f:append("$xfoo$ybar")</tt>
	
</ul>

</div>



<div>

<h3 class="inline-block">Return value:</h3>
the field

</div>




</dd>




<dt><a name="PicaField:codes"></a><strong>PicaField:codes</strong>&nbsp;()</dt>
<dd>
Returns an ordered table of subfield codes. For instance for a field <tt>$xfoo$ybar$xdoz</tt> this method returns the table <tt>{'x','y','x'}</tt>.









</dd>




<dt><a name="PicaField:collect"></a><strong>PicaField:collect</strong>&nbsp;(...)</dt>
<dd>
Concatenate table of subfield values. TODO: check this and compare with :values :map etc.


<h3>Parameters</h3>
<ul>
	
	<li>
	  ...: 
	</li>
	
</ul>







<div>

<h3>See also:</h3>
<ul>
	
	<li><a href="">
		PicaField:get
	</a>
	
	<li><a href="">
		PicaField:join
	</a>
	
</ul>

</div>


</dd>




<dt><a name="PicaField:copy"></a><strong>PicaField:copy</strong>&nbsp;(full, subfields)</dt>
<dd>
Copies a field.


<h3>Parameters</h3>
<ul>
	
	<li>
	  full: 
	</li>
	
	<li>
	  subfields: 
	</li>
	
</ul>



<div>

<h3>Usage</h3>
<ul>
	
	<li><tt>field:copy()</tt> full copy with tag, occ and all subfields
	
	<li><tt>field:copy("123@")</tt> copy subfields but modify tag
	
	<li><tt>field:copy("123@/01")</tt> copy subfields but modify tag and occ
	
	<li><tt>field:copy("a-d")</tt> copy tag, occ, and selected subfields
	
	<li><tt>field:copy("")</tt> copy only all subfields
	
</ul>

</div>






</dd>




<dt><a name="PicaField:first"></a><strong>PicaField:first</strong>&nbsp;(code, ...)</dt>
<dd>
Returns the first value of a given subfield or an empty string.


<h3>Parameters</h3>
<ul>
	
	<li>
	  code: 
	</li>
	
	<li>
	  ...: subfield code and/or optional filters
	</li>
	
</ul>








</dd>




<dt><a name="PicaField:has"></a><strong>PicaField:has</strong>&nbsp;(...)</dt>
<dd>
Checks whether a field contains a given subfield.


<h3>Parameters</h3>
<ul>
	
	<li>
	  ...: subfield code (one character of <tt>a-z</tt>, <tt>A-Z</tt> or <tt>0-9</tt>)
	</li>
	
</ul>



<div>

<h3 class="inline-block">Usage:</h3>
<tt>f:has("x")</tt> or <tt>f % "x"</tt>

</div>



<div>

<h3 class="inline-block">Return value:</h3>
boolean result of <tt>(self:first( subfield ) ~= "")</tt>

</div>




</dd>




<dt><a name="PicaField:join"></a><strong>PicaField:join</strong>&nbsp;(sep, ...)</dt>
<dd>
Collect and join subfield values.


<h3>Parameters</h3>
<ul>
	
	<li>
	  sep: 
	</li>
	
	<li>
	  ...: 
	</li>
	
</ul>







<div>

<h3>See also:</h3>
<ul>
	
	<li><a href="">
		PicaField:collect
	</a>
	
</ul>

</div>


</dd>




<dt><a name="PicaField:values"></a><strong>PicaField:values</strong>&nbsp;(...)</dt>
<dd>
Returns a list of subfield values. Calling this method as <tt>field:values(...)</tt> is equivalent to calling <tt>unpack(field:all(...))</tt>. In contrast to <tt>all</tt> and <tt>get</tt> this method returns not a table but a list of non-empty strings.


<h3>Parameters</h3>
<ul>
	
	<li>
	  ...: locator and/or filters
	</li>
	
</ul>



<div>

<h3>Usage</h3>
<ul>
	
	<li><tt>x,y,z = field:values()</tt>
	
	<li><tt>n = field:values('a',patternfilter('^%d+$'))</tt>
	
</ul>

</div>





<div>

<h3>See also:</h3>
<ul>
	
	<li><a href="">
		PicaField:all
	</a>
	
	<li><a href="">
		PicaField:get
	</a>
	
</ul>

</div>


</dd>




<dt><a name="PicaRecord.new"></a><strong>PicaRecord.new</strong>&nbsp;(str)</dt>
<dd>
Creates a new PICA+ record. If you provide a string, it will be parsed as PICA+ format.


<h3>Parameters</h3>
<ul>
	
	<li>
	  str: (optional string) string to parse
	</li>
	
</ul>








</dd>




<dt><a name="PicaRecord.parse_field_locator"></a><strong>PicaRecord.parse_field_locator</strong>&nbsp;(locator, subfield, ...)</dt>
<dd>
Parses a field locator.


<h3>Parameters</h3>
<ul>
	
	<li>
	  locator: 
	</li>
	
	<li>
	  subfield: 
	</li>
	
	<li>
	  ...: 
	</li>
	
</ul>







<div>

<h3>See also:</h3>
<ul>
	
	<li><a href="">
		PicaRecord:all
	</a>
	
	<li><a href="">
		PicaRecord:first
	</a>
	
</ul>

</div>


</dd>




<dt><a name="PicaRecord:all"></a><strong>PicaRecord:all</strong>&nbsp;(field, subfield, ...)</dt>
<dd>
Returns all matching subfield values (as table) or all matching fields (as record). You can filter fields by tag (and occurence indicator) and/or by using a filter method that is called for each field as <tt>filter(field)</tt>. A field is only included in the returned record, if the filter method returns true. Note that the returned record contains references to the original fields instead of copies!


<h3>Parameters</h3>
<ul>
	
	<li>
	  field: (optional) field locator
	</li>
	
	<li>
	  subfield: 
	</li>
	
	<li>
	  ...: function that is applied to each value as filter
	</li>
	
</ul>



<div>

<h3 class="inline-block">Usage:</h3>
r:all('021A')

</div>



<div>

<h3 class="inline-block">Return value:</h3>
table or PicaRecord

</div>



<div>

<h3>See also:</h3>
<ul>
	
	<li><a href="">
		PicaRecord:apply
	</a>
	
</ul>

</div>


</dd>




<dt><a name="PicaRecord:append"></a><strong>PicaRecord:append</strong>&nbsp;(field)</dt>
<dd>
Appends a field to the record.


<h3>Parameters</h3>
<ul>
	
	<li>
	  field: PicaField object to append
	</li>
	
</ul>








</dd>




<dt><a name="PicaRecord:apply"></a><strong>PicaRecord:apply</strong>&nbsp;(...)</dt>
<dd>
Apply one or more function to each field of the record. In contrast to PicaRecord:filter, the return values of functions are ignored and nothing is returned.


<h3>Parameters</h3>
<ul>
	
	<li>
	  ...: functions that are called for each field
	</li>
	
</ul>







<div>

<h3>See also:</h3>
<ul>
	
	<li><a href="">
		PicaRecord:filter
	</a>
	
</ul>

</div>


</dd>




<dt><a name="PicaRecord:first"></a><strong>PicaRecord:first</strong>&nbsp;(field, subfield, ...)</dt>
<dd>
Returns the first matching field or subfield value


<h3>Parameters</h3>
<ul>
	
	<li>
	  field: locator of a field (<tt>AAAA</tt> or <tt>AAAA/</tt> or <tt>AAAA/BB</tt> or <tt>AAAA/00</tt>)
	</li>
	
	<li>
	  subfield: 
	</li>
	
	<li>
	  ...: 
	</li>
	
</ul>



<div>

<h3 class="inline-block">Usage:</h3>
<tt>rec["028A/"]</tt> returns field 028A but not 028A/xx, <tt>rec["028A"]</tt> returns field 028A or 028A/xx, <tt>rec["028A/00"]</tt> returns field 028A/xx but not or 028A, <tt>rec["028A/01"]</tt> returns field 028A/01

</div>






</dd>




<dt><a name="PicaRecord:get"></a><strong>PicaRecord:get</strong>&nbsp;(query, ...)</dt>
<dd>
Get matching values from the record. with error checking


<h3>Parameters</h3>
<ul>
	
	<li>
	  query: 
	</li>
	
	<li>
	  ...: 
	</li>
	
</ul>








</dd>




<dt><a name="PicaRecord:has"></a><strong>PicaRecord:has</strong>&nbsp;(...)</dt>
<dd>
Returns whether a given locator matches.


<h3>Parameters</h3>
<ul>
	
	<li>
	  ...: 
	</li>
	
</ul>








</dd>




<dt><a name="PicaRecord:map"></a><strong>PicaRecord:map</strong>&nbsp;(map)</dt>
<dd>
Transforms the record to a table using a mapping table.


<h3>Parameters</h3>
<ul>
	
	<li>
	  map: mapping table
	</li>
	
</ul>





<div>

<h3>Return values:</h3>
<ol>
	
	<li>table of transformed values
	
	<li>table of errors or nil of no errors occurred
	
</ol>

</div>



<div>

<h3>See also:</h3>
<ul>
	
	<li><a href="">
		PicaRecord:get
	</a>
	
</ul>

</div>


</dd>




<dt><a name="filtervalue"></a><strong>filtervalue</strong>&nbsp;(value, ...)</dt>
<dd>
Simply returns a value, optionally filtered by one or more functions. If a filter function returns true, the original value is returned. If a filter function returns no string or the empty string, nil is returned.


<h3>Parameters</h3>
<ul>
	
	<li>
	  value: 
	</li>
	
	<li>
	  ...: 
	</li>
	
</ul>








</dd>




<dt><a name="formatfilter"></a><strong>formatfilter</strong>&nbsp;(format)</dt>
<dd>
Returns a filter function based on a Lua string format.


<h3>Parameters</h3>
<ul>
	
	<li>
	  format: as specified for <a href="http://www.lua.org/manual/5.1/manual.html#5.4">string.format</a>
	</li>
	
</ul>



<div>

<h3 class="inline-block">Usage:</h3>
<tt>field:first('a',formatfilter('a is: %s'))</tt>

</div>






</dd>




<dt><a name="patternfilter"></a><strong>patternfilter</strong>&nbsp;(pattern)</dt>
<dd>
Returns a filter function based on a Lua pattern. The returned filter function removes all values that do not match the pattern. If the pattern contains a capture expression, each value is replaced by the first captured value.


<h3>Parameters</h3>
<ul>
	
	<li>
	  pattern: a <a href="http://www.lua.org/manual/5.1/manual.html#5.4.1">pattern</a>
	</li>
	
</ul>



<div>

<h3>Usage</h3>
<ul>
	
	<li>check digit: <tt>record:find(tag,sf,patternfilter('%d'))</tt>
	
	<li>extract digit: <tt>record:find(tag,sf,patternfilter('(%d)'))</tt>
	
</ul>

</div>






</dd>




<dt><a name="string.notempty"></a><strong>string.notempty</strong>&nbsp;(self)</dt>
<dd>
Returns a string or nil if the string is empty


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: 
	</li>
	
</ul>








</dd>




<dt><a name="table.append"></a><strong>table.append</strong>&nbsp;(t, a)</dt>
<dd>
Insert all values with integer keys from one table to another.


<h3>Parameters</h3>
<ul>
	
	<li>
	  t: the table to modify
	</li>
	
	<li>
	  a: the table to concat to table a
	</li>
	
</ul>








</dd>


</dl>


</div> <!-- id="content" -->

</div> <!-- id="main" -->

<div id="about">
	<p><a href="http://validator.w3.org/check?uri=referer"><img src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0!" height="31" width="88" /></a></p>
</div> <!-- id="about" -->

</div> <!-- id="container" -->	
</body>
</html>
